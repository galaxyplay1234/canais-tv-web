<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<title>On Futebol</title>
<style>
body { margin:0; font-family: 'Maven Pro', sans-serif; background: #f9f9f9;}
header { background: #4CAF50; color: white; padding: 12px; text-align: center; }
.lista-canais {
  display: flex; flex-wrap: wrap; gap: 10px; padding: 10px;
}
.lista-canais a {
  flex: 1 1 150px;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  text-align: center;
  color: black;
  text-decoration: none;
  background: white;
  transition: background 0.3s;
}
.lista-canais a:hover {
  background: #e0f2e9;
}
.iconelista {
  width: 100%;
  max-height: 50px;
  object-fit: contain;
  margin-bottom: 5px;
  border-radius: 6px;
}

iframe[name="VideoPlayer"] {
  width: 100%;
  max-width: 560px;
  height: calc(560px * 9 / 16);
  border: none;
  border-radius: 12px;
  display: block;
  margin: 20px auto;
  background: #000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Para telas menores */
@media (max-width: 560px) {
  iframe[name="VideoPlayer"] {
    width: 100%;
    height: calc(100vw * 9 / 16); /* altura proporcional à largura da viewport */
  }
}

#buscaCanais {
  width: 80%;
  max-width: 500px;
  margin: 20px auto;
  display: block;
  padding: 10px 15px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 10px;
}


</style>
</head>
<body>

<header id="mudartexto">Atualizado<br>Escolha um canal abaixo para assistir</header>

<iframe name="VideoPlayer" allow="encrypted-media" allowfullscreen="" frameborder="0"></iframe>



<input type="text" id="buscaCanais" placeholder="Buscar canal...">

<div class="lista-canais" id="listaCanais"></div>

<script>
  // Config do Firebase (use a sua config)
  const firebaseConfig = {
    apiKey: "AIzaSyC_zjO-vZyeG_LzWhSbsr_lHrQbhq8C5gc",
    authDomain: "canais-tv-web.firebaseapp.com",
    databaseURL: "https://canais-tv-web-default-rtdb.firebaseio.com",
    projectId: "canais-tv-web",
    storageBucket: "canais-tv-web.appspot.com",
    messagingSenderId: "77739128467",
    appId: "1:77739128467:web:dea40e2c692886315f3f66"
  };

  // Inicializa Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Variável global para usuários do Firebase
  let usuariosFirebase = [];

  // Função para carregar usuários do Firebase
  function carregarUsuariosFirebase() {
    return new Promise((resolve, reject) => {
      db.ref('usuarios').once('value', snapshot => {
        usuariosFirebase = [];
        snapshot.forEach(childSnapshot => {
          const u = childSnapshot.val();
          usuariosFirebase.push({ nome: u.nome, codigo: u.codigo });
        });
        resolve(usuariosFirebase);
      }, reject);
    });
  }

  // Função para validar login
  async function validarLogin() {
    try {
      await carregarUsuariosFirebase();
      const acessoLiberado = localStorage.getItem("acessoLiberado");
      const usuarioNome = localStorage.getItem("usuarioNome");

      if (
        acessoLiberado !== "true" ||
        !usuariosFirebase.some(u => u.nome === usuarioNome)
      ) {
        // Se não estiver logado ou usuário removido, desloga
        localStorage.removeItem("acessoLiberado");
        localStorage.removeItem("usuarioNome");
        window.location.href = "login.html";
      }
    } catch (e) {
      alert("Erro ao validar login: " + e.message);
      // Opcional: redirecionar para login se erro
      window.location.href = "login.html";
    }
  }

  validarLogin();

  // -- O resto do seu script permanece igual --

  // Código abaixo mantém a funcionalidade dos canais etc, sem mexer
  let canais = [];
  let listaCanaisOriginal = [];
  let canalAtivo = null;

  function mudarCanal(name) {
    document.getElementById("mudartexto").innerHTML = "Você está assistindo:<br>" + name;
  }

  function montarLista(canaisParaExibir) {
    const container = document.getElementById("listaCanais");
    container.innerHTML = "";

    canaisParaExibir.forEach(canal => {
      const a = document.createElement("a");
      a.href = "#";

      if (canal.name === canalAtivo) {
        a.style.backgroundColor = "#e0f2e9";
      }

      a.onclick = (e) => {
        e.preventDefault();
        canalAtivo = canal.name;
        document.querySelector('iframe[name="VideoPlayer"]').src = canal.url;
        mudarCanal(canal.name);
        document.getElementById('buscaCanais').value = "";
        montarLista(listaCanaisOriginal);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      a.innerHTML = `
        <img src="${canal.image}" alt="${canal.name}" class="iconelista" />
        <b>${canal.name}</b><br>
      `;

      container.appendChild(a);
    });

    if (canaisParaExibir.length === 0) {
      container.innerHTML = "<p>Nenhum canal encontrado.</p>";
    }
  }

  fetch("https://sinalpublico.vercel.app/channels.json")
    .then(res => res.json())
    .then(data => {
      canais = data;
      listaCanaisOriginal = data;
      montarLista(canais);
    });

  document.getElementById('buscaCanais').addEventListener('input', function () {
    const termo = this.value.toLowerCase();
    const filtrados = listaCanaisOriginal.filter(c =>
      c.name.toLowerCase().includes(termo) ||
      (c.category && c.category.toLowerCase().includes(termo))
    );
    montarLista(filtrados);
  });

  const iframe = document.querySelector('iframe[name="VideoPlayer"]');

  iframe.addEventListener('dblclick', () => {
    const requestFullscreen = iframe.requestFullscreen || iframe.webkitRequestFullscreen || iframe.mozRequestFullScreen || iframe.msRequestFullscreen;
    if (requestFullscreen) {
      requestFullscreen.call(iframe);
    } else {
      alert("Seu navegador não suporta fullscreen.");
    }
  });

</script>

<script>
  const iframe = document.getElementById('videoPlayer');

  iframe.addEventListener('dblclick', () => {
    const requestFullscreen = iframe.requestFullscreen || iframe.webkitRequestFullscreen || iframe.mozRequestFullScreen || iframe.msRequestFullscreen;
    if (requestFullscreen) {
      requestFullscreen.call(iframe);
    } else {
      alert("Seu navegador não suporta fullscreen.");
    }
  });
</script>
</body>
</html>