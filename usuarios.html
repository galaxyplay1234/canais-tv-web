<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerenciar Usuários (Firebase)</title>
  <style>
    /* Seu CSS igual ao anterior */
    #container input,
#container button {
  display: block;
  box-sizing: border-box;
  width: 100%;
  margin: 0 0 15px 0; /* margem inferior */
}

#container {
  max-width: 400px;
  width: 100%;
  padding: 25px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  margin-top: 20px;
  /* adicione para evitar deslocamento inesperado */
  text-align: left;
}

body {
  font-family: Arial, sans-serif;
  background: #f0f0f0;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding: 20px;
  /* força largura total para não deixar inputs saírem */
  overflow-x: hidden;
}

    input, button { width: 100%; margin-bottom: 15px; padding: 12px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; }
    input:focus { border-color: #28a745; outline: none; }
    button {
      border:none; background:#28a745; color:#fff; cursor:pointer; transition: background-color 0.3s;
    }
    button:hover { background:#218838; }
    ul { list-style:none; padding-left:0; max-height: 300px; overflow-y:auto; }
    li {
      background: #f9f9f9; margin-bottom: 10px; padding: 12px 15px; border-radius: 8px;
      display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      word-break: break-word;
    }
    button.removeBtn {
  background: #e74c3c;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  padding: 4px 5px;       /* menor padding */
  font-size: 13px;         /* fonte um pouco menor */
  transition: background-color 0.3s;
  height: auto;            /* pra garantir altura automática */
  
}
    .removeBtn:hover { background:#c0392b; }
  </style>
</head>
<body>
  <div id="container">
    <h2>Gerenciar Códigos de Acesso</h2>
    <input id="nomeUsuario" type="text" placeholder="Nome do usuário" autocomplete="off" />
    <input id="codigoUsuario" type="text" placeholder="Código de acesso" autocomplete="off" />
    <button id="btnAdicionar">Adicionar Usuário</button>
    <ul id="listaUsuarios"></ul>
  </div>

  <!-- Firebase App (the core Firebase SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC_zjO-vZyeG_LzWhSbsr_lHrQbhq8C5gc",
      authDomain: "canais-tv-web.firebaseapp.com",
      databaseURL: "https://canais-tv-web-default-rtdb.firebaseio.com",
      projectId: "canais-tv-web",
      storageBucket: "canais-tv-web.firebasestorage.app",
      messagingSenderId: "77739128467",
      appId: "1:77739128467:web:dea40e2c692886315f3f66"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const listaUsuarios = document.getElementById('listaUsuarios');
    let usuarios = {}; // objeto para armazenar usuários com chave do DB

    // Carregar usuários do Firebase
    function carregarUsuarios() {
      const usuariosRef = ref(db, 'usuarios');
      onValue(usuariosRef, (snapshot) => {
        const data = snapshot.val();
        usuarios = data || {};
        renderizarLista();
      });
    }

    function renderizarLista() {
      listaUsuarios.innerHTML = '';
      if (Object.keys(usuarios).length === 0) {
        listaUsuarios.innerHTML = '<li>Nenhum usuário cadastrado</li>';
        return;
      }

      Object.entries(usuarios).forEach(([key, { nome, codigo }]) => {
        const li = document.createElement('li');
        li.textContent = `${nome} — Código: ${codigo}`;

        const btnRemover = document.createElement('button');
        btnRemover.textContent = 'Remover';
        btnRemover.classList.add('removeBtn');
        btnRemover.onclick = () => removerUsuario(key);

        li.appendChild(btnRemover);
        listaUsuarios.appendChild(li);
      });
    }

    // Adicionar usuário novo
    async function adicionarUsuario(nome, codigo) {
      // verifica se código já existe
      if (Object.values(usuarios).some(u => u.codigo === codigo)) {
        alert('Código já existe!');
        return;
      }
      // salva novo usuário
      const novoUsuarioRef = push(ref(db, 'usuarios'));
      await set(novoUsuarioRef, { nome, codigo });
    }

    // Remover usuário por chave
    async function removerUsuario(key) {
      await remove(ref(db, 'usuarios/' + key));
      // Se quiser, checar e remover localStorage igual antes
    }

    document.getElementById('btnAdicionar').onclick = async () => {
      const nome = document.getElementById('nomeUsuario').value.trim();
      const codigo = document.getElementById('codigoUsuario').value.trim();

      if (!nome || !codigo) {
        alert('Preencha nome e código!');
        return;
      }
      try {
        await adicionarUsuario(nome, codigo);
        document.getElementById('nomeUsuario').value = '';
        document.getElementById('codigoUsuario').value = '';
      } catch(e) {
        alert('Erro ao adicionar usuário: ' + e.message);
      }
    };

    carregarUsuarios();
  </script>
</body>
</html>